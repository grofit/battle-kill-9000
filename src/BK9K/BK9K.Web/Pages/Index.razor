@page "/"
@using BK9K.Framework.Grids
@using BK9K.Framework.Units
@using BK9K.Framework.Extensions
@using System.Reactive.Linq
@using System
@using BK9K.Game

@implements IDisposable

@inject GridBuilder GridBuilder
@inject UnitBuilder UnitBuilder

<div>
    <p class="title">BATTLE TEST</p>
    <div class="columns">
        <div class="column">
            <UnitAvatar Unit="Game.PlayerUnit" />
        </div>
        <div class="column">
        </div>
        <div class="column">
            <UnitAvatar Unit="Game.EnemyUnit" />
        </div>
    </div>
</div>

@code
{
    public GameBootstrap Game;
    private IDisposable _gameUpdateSub;

    protected override void OnInitialized()
    {
        Game = new GameBootstrap();
        Game.StartGame();

        _gameUpdateSub = Game.OnUpdated.Subscribe(unit => StateHasChanged());

        base.OnInitialized();
    }

    public void Dispose()
    {
        Game?.Dispose();
        _gameUpdateSub?.Dispose();
    }
}
