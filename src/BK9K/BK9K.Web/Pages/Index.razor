@page "/"
@using BK9K.Framework.Grids
@using BK9K.Framework.Units
@using BK9K.Framework.Extensions
@using System.Reactive.Linq
@using System

@implements IDisposable

@inject GridBuilder GridBuilder
@inject UnitBuilder UnitBuilder

<div>
    <p class="title">BATTLE TEST</p>
    <div class="columns">
        <div class="column">
            @if (!Game.PlayerUnit.IsDead())
            {
                <UnitAvatar Unit="Game.PlayerUnit" />
            }
            else
            {
                <p class="subtitle is-size-5 has-text-danger">@Game.(PlayerUnit.Name)'s Dead</p>
            }
        </div>
        <div class="column">
        </div>
        <div class="column">
            @if (!Game.EnemyUnit.IsDead())
            {
                <UnitAvatar Unit="Game.EnemyUnit" />
            }
            else
            {
                <p class="subtitle is-size-5 has-text-danger">@(Game.EnemyUnit.Name)'s Dead</p>
            }
        </div>
    </div>
</div>

@code
{
    public Game Game;
    private IDisposable _gameUpdateSub;

    protected override void OnInitialized()
    {
        Game = new Game();
        Game.StartGame();

        _gameUpdateSub = Game.OnUpdated.Subscribe(unit => StateHasChanged());

        base.OnInitialized();
    }

    public void Dispose()
    {
        Game?.Dispose();
        _gameUpdateSub?.Dispose();
    }
}
